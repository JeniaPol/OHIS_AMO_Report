# OHIS AmoCRM → Отчёт по тегам (v2)

- Каждая строка = выбранный **тег сделки**.
- Автокомплит тегов из файла.
- Даты нужны только для режима **Брошенная корзина**; для **Автосообщение/Через менеджера** даты не используются.

## Установка и запуск

```bash
python -m venv .venv
# macOS/Linux:
source .venv/bin/activate
# Windows:
# .venv\Scripts\activate

pip install -r requirements.txt
streamlit run app.py
```

## Структура проекта

```
OHIS_AMO_Report/
  app.py                  # Streamlit-приложение
  config.yaml             # Конфигурация стадий/воронок
  amo_report/
    __init__.py
    config.py             # загрузка конфигурации
    utils.py              # нормализация, парсинг тегов, агрегаты
    report.py             # вычисление метрик и отчёта
```

## Минимальные колонки во входном файле

`Этап сделки`, `Воронка`, `Теги сделки`, `Бюджет`, `Дата создания`, `Основной контакт`

## Конфигурация

Меняйте соответствия этапов и воронок в `config.yaml`.

## Экспорт в Google Sheets

1. Создайте Service Account в Google Cloud и выдайте ему доступ на ваш Spreadsheet (Editor).
2. Скачайте JSON ключ и вставьте его содержимое в поле "Service Account JSON" в приложении.
3. Укажите Spreadsheet ID (строка из URL таблицы).
4. Нажмите "Обновить Google Sheets" — будут созданы/очищены два листа:
   - `... | Отчёт`
   - `... | Список_Отклик`
